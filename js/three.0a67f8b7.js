(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["three"],{"086b":function(t,e,i){"use strict";var s=i("16a5"),n=i.n(s);n.a},"16a5":function(t,e,i){},"295e":function(t,e,i){"use strict";var s=i("2c57"),n=i.n(s);n.a},"2c57":function(t,e,i){},d1dc:function(t,e,i){},e1b1:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.loaded?i("div",{staticClass:"grid"},[i("div",{staticClass:"header"},[i("h1",{staticClass:"total"},[i("strong",[t._v(t._s(t.formattedItemsTotal))]),t._v(" "+t._s(t.thing)+". ")])]),i("div",{staticClass:"sort"},[i("router-link",{class:["sort-button","default"===t.sort?"active":""],attrs:{to:{path:"/"}}},[t._v(" default ")]),i("router-link",{class:["sort-button","hue"===t.sort?"active":""],attrs:{to:{path:"/",query:{sort:"hue"}}}},[t._v(" color ")])],1),i("viz",{staticClass:"viz"})],1):t._e()},n=[],o=i("2f62"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"three"},[i("div",{ref:"file",staticClass:"file hidden"},[t.fileData.palette?i("div",{staticClass:"palette"},t._l(t.fileData.palette,(function(t,e){return i("span",{key:e,staticClass:"color",style:{backgroundColor:t.color,width:100*t.percent+"%"}})})),0):t._e(),t.fileData.title?t._e():i("div",{staticClass:"loading"},[t._v("Loading...")]),t.fileData.image?i("img",{staticClass:"thumbnail",attrs:{src:t.fileData.image,alt:""}}):t._e(),t.fileData.title?i("p",[t._v(t._s(t.fileData.title))]):t._e()]),i("canvas",{ref:"three",staticClass:"three",on:{mousemove:t.onCanvasMouseMove,dblclick:function(e){return e.preventDefault(),t.onDoubleClick(e)},click:function(e){return e.preventDefault(),t.onClick(e)}}})])},a=[],l=i("5a89"),c=i("b9d8"),h=i("920c");function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function d(t,e,i){return e&&f(t.prototype,e),i&&f(t,i),t}function m(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}function v(t,e){return v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},v(t,e)}function w(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(t,e){return!e||"object"!==typeof e&&"function"!==typeof e?w(t):e}function T(t){return b(t)||x(t)||E()}function b(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function x(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function E(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var C=window.THREE?window.THREE:{LinearFilter:l["m"],Sprite:l["D"],SpriteMaterial:l["E"],Texture:l["F"]},S=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rgba(255, 255, 255, 1)";return u(this,e),t=g(this,p(e).call(this,new C.SpriteMaterial({map:new C.Texture}))),t._text="".concat(i),t._textHeight=s,t._color=n,t._fontFace="Arial",t._fontSize=90,t._fontWeight="normal",t._canvas=document.createElement("canvas"),t._texture=t.material.map,t._texture.minFilter=C.LinearFilter,t._genCanvas(),t}return m(e,t),d(e,[{key:"_genCanvas",value:function(){var t=this,e=this._canvas,i=e.getContext("2d"),s=this._text.split("\n"),n="".concat(this.fontWeight," ").concat(this.fontSize,"px ").concat(this.fontFace);i.font=n,e.width=Math.max.apply(Math,T(s.map((function(t){return i.measureText(t).width})))),e.height=this.fontSize*s.length,i.font=n,i.fillStyle=this.color,i.textBaseline="bottom",s.forEach((function(s,n){return i.fillText(s,(e.width-i.measureText(s).width)/2,(n+1)*t.fontSize)})),this._texture.image=e,this._texture.needsUpdate=!0;var o=this.textHeight*s.length;this.scale.set(o*e.width/e.height,o)}},{key:"clone",value:function(){return new this.constructor(this.text,this.textHeight,this.color).copy(this)}},{key:"copy",value:function(t){return C.Sprite.prototype.copy.call(this,t),this.color=t.color,this.fontFace=t.fontFace,this.fontSize=t.fontSize,this.fontWeight=t.fontWeight,this}},{key:"text",get:function(){return this._text},set:function(t){this._text=t,this._genCanvas()}},{key:"textHeight",get:function(){return this._textHeight},set:function(t){this._textHeight=t,this._genCanvas()}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._genCanvas()}},{key:"fontFace",get:function(){return this._fontFace},set:function(t){this._fontFace=t,this._genCanvas()}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._genCanvas()}},{key:"fontWeight",get:function(){return this._fontWeight},set:function(t){this._fontWeight=t,this._genCanvas()}}]),e}(C.Sprite),y=S;const _=i("bc3a").default,k="4GiyqFNOt7ZdMZCubAdC5WVq9zGeaT8P",I="https://apiv2.sl.nsw.gov.au/collection/v1",M="http://localhost:3000/image",D="https://collection.sl.nsw.gov.au/digital/file",P=500,A=.001,j=10,F=45,O=4,z=0,R=2048,B=64,N=32,L=.49,G=1,$=.003,H=1e3,W=new l["e"]("hsl(3.6, 100%, 29%)"),q=10,U=300,V=1e3,J=300,Y=1,X=.06,Z=0,K=.03125,Q=.9,tt=_.create({baseURL:I,headers:{"x-api-key":k},timeout:1e4}),et="\nprecision mediump float;\n\n// these come built in with three.js; they're basically always used in the same way (see below)\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec3 cameraPosition;\n\n// these are uniforms we specified\nuniform float atlasPx;\nuniform float cellPx;\nuniform float pointScale;\nuniform float atlases;\n\n// these are the buffer attributes we specified when creating the geometry\nattribute vec3 position;\nattribute vec2 uv;\n\n// these are attributes we will pass from the vertex to the fragment shader\nvarying vec2 vUv;\nvarying float vAtlases;\n\nattribute float size;\nattribute vec3 color;\nvarying vec3 vColor;\n\nvoid main() {\n  vColor = color;\n  vAtlases = atlases;\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n  gl_PointSize = size * ( 1400.0 / -mvPosition.z );\n  gl_Position = projectionMatrix * mvPosition;\n\n  // pass the varying data to the fragment shader\n  vUv = uv;\n}\n",it="\nprecision mediump float;\n\nuniform sampler2D texture;\nuniform float atlasPx;\nuniform float cellPx;\n\nvarying vec2 vUv;\nvarying float vAtlases;\nvarying vec3 vColor;\n\nvoid main() {\n  vec2 uv = (vUv * cellPx + gl_PointCoord.xy * cellPx) / atlasPx;\n\n  if (vAtlases > 0.5) {\n    gl_FragColor = texture2D(texture, uv);\n    } else {\n    gl_FragColor = vec4(vColor, 1.0);\n  }\n\n  // this line mixes the actual texture color with some red\n  //gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), 0.5);\n}\n",st=t=>{const e=new l["a"],i=t.instanceMatrix.count,s=new l["o"],n=new l["I"],o=new l["I"],r=new l["v"];for(let a=0,c=0,h=i;a<h;a++,c+=3){t.getMatrixAt(a,s),s.decompose(n,r,o);const i=n.x,c=n.y,h=n.z,u=new l["p"](new l["t"](Q*o.x,Q*o.x));u.position.set(i,c,h*o.x),e.expandByObject(u)}return e},nt=t=>{const e=new l["a"],i=t.children.length;for(let s=0,n=i;s<n;s++){const i=t.children[s];e.expandByObject(i)}return e},ot=(t,e,i,s)=>(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e,rt=()=>{const t=window.innerWidth/window.innerHeight,e=new l["s"](F,t,A,j);return e.position.x=0,e.position.y=0,e.position.z=G+10,e.updateProjectionMatrix(),e},at=(t,e,i,s,n)=>{t=t||"[undefined]",isNaN(t)&&-1!==t.indexOf("|||")&&(t=t.split("|||")[1]);const o=new y(t);return o.fontFace="Space Mono",o.textHeight=X*n,o.position.set(e,i,s),o.center=new l["H"](0,0),o};var lt={components:{},data(){return{bucketsGroup:null,camera:null,cameraMoveStart:null,cameraObj:null,controls:null,cursor:null,isMoving:!1,lastMouseMoveId:null,lastChange:0,lastFileId:null,fileData:{},fileMode:!1,filesGroup:null,filesLoaded:null,filesMoveFrom:null,filesMoveStart:null,filesMoveTo:null,filesObject:null,lastCamera:null,mouse:{},PAST_INTERSECTED:{},pickingScene:null,pickingTexture:null,pixelBuffer:null,raycaster:null,renderer:null,scaled:!1,scene:null,showAtlases:!1,selectedInstance:{},selectedBucket:null,textGroup:null,toCamera:null,toLook:null,visibleFiles:[],visibleFilesCount:0}},computed:{...Object(o["c"])(["totalFromBuckets"]),...Object(o["d"])(["defaultPositions","defaultColors","huePositions","atlases","loadedAtlas","currentBucket","itemsTotal","sort","stuff"])},mounted(){this.init(),this.createControls(),this.paintBuckets(),this.moveCameraTo(this.bucketsGroup),this.animate(),window.addEventListener("resize",this.onResize),document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("mouseout",this.onDocumentMouseOut)},beforeDestroy(){window.removeEventListener("resize",this.onResize),document.removeEventListener("mousemove",this.onDocumentMouseMove),document.removeEventListener("mouseout",this.onDocumentMouseOut)},watch:{currentBucket(t){t&&(this.cameraObj&&(this.initFiles(this.cameraObj),this.paintSort()),this.getcurrentAtlases())},loadedAtlas(t){0===t&&this.paintAtlas()},scaled(t){},sort(t,e){this.filesMoveStart=Date.now(),this.filesMoveFrom=e,this.filesMoveTo=t}},methods:{paintSort(){this.filesObject&&(this.filesMoveStart=Date.now()-J,this.filesMoveTo=this.sort)},init(){this.renderer=new l["K"]({antialias:!0,canvas:this.$refs.three,powerPreference:"high-performance"}),this.renderer.outputEncoding=l["L"],this.renderer.gammaFactor=2.2,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.scene=new l["y"],this.scene.background=new l["e"]("hsl(0, 0%, 15%)"),this.raycaster=new l["x"],this.mouse=new l["H"](-1e10,-1e10),this.pickingScene=new l["y"],this.pickingScene.background=new l["e"](0),this.pickingTexture=new l["J"](window.innerWidth,window.innerHeight),this.pixelBuffer=new Uint8Array(4),this.camera=rt();const t=new l["B"]((new l["A"]).moveTo(Q/2,Q/2).lineTo(Q/2,-Q/2).lineTo(-Q/2,-Q/2).lineTo(-Q/2,Q/2).lineTo(Q/2,Q/2)),e=new l["q"]({color:W}),i=new l["p"](t,e);i.visible=!1,this.cursor=i,this.scene.add(this.cursor);const s=new c["a"];s.add(this,"showAtlases")},onDoubleClick(t){if(this.fileMode){if(void 0!==this.PAST_INTERSECTED.fileId){const t=D+"/"+this.PAST_INTERSECTED.fileId;window.open(t,"_blank")}}else if(void 0!==this.PAST_INTERSECTED.instanceId){this.selectedBucket=this.stuff[this.PAST_INTERSECTED.obj.bucketIndex];const t=this.selectedBucket.count,e=t/this.itemsTotal,i=this.scaled?L:Math.sqrt(e),s=this.PAST_INTERSECTED.obj.position.x,n=this.PAST_INTERSECTED.obj.position.y,o=this.PAST_INTERSECTED.obj.geometry.parameters.width*i,r=new l["p"](new l["t"](o,o));r.position.set(s,n,$),this.moveCameraTo(r),this.fileMode=!0,this.cameraObj=r,window.setTimeout(()=>this.PAST_INTERSECTED={},100),this.$store.commit("setBucket",this.selectedBucket)}},onClick(){if(console.log("click",this.PAST_INTERSECTED),!this.isMoving)if(this.fileMode)if(void 0===this.PAST_INTERSECTED.instanceId)console.log("outside"),this.fileMode=!1,this.cleanFiles(),this.moveCameraTo(this.selectedInstance.obj),this.$store.commit("setBucket",null);else{console.log("file");const t=new l["r"];t.position.set(this.PAST_INTERSECTED.obj),this.moveCameraTo(t)}else void 0!==this.PAST_INTERSECTED.instanceId?this.PAST_INTERSECTED.instanceId!==this.selectedInstance.instanceId&&(console.log("bucket"),this.hideCursor(),this.moveCameraTo(this.PAST_INTERSECTED.obj),this.selectedInstance={...this.PAST_INTERSECTED}):(console.log("main"),this.moveCameraTo(this.bucketsGroup),this.hideCursor(),this.selectedInstance={},this.fileMode=!1),this.$store.commit("setBucket",null)},createControls(){this.controls=new h["a"](this.camera,this.$refs.three),this.controls.rotateSpeed=1,this.controls.zoomSpeed=1,this.controls.panSpeed=1,this.controls.maxDistance=O,this.controls.minDistance=z,this.controls.noRotate=!0,this.controls.screenSpacePanning=!0,this.controls.enableDamping=!0,this.controls.dampingFactor=.1},filesInView(){if(!this.fileMode||!this.filesObject)return;const t=Date.now();if(t-this.lastChange<H)return;this.lastChange=t;const e=this.camera.position.x,i=this.camera.position.y,s=this.camera.position.z-$,n=this.camera.aspect,o=2*s*Math.tan(.5*F*(Math.PI/180)),r=o*n,{side:a,realW:l,x:c,y:h}=this.filesObject.mga,u=l/a;let f=e-.5*r,d=i-.5*o,m=e+.5*r,p=i+.5*o;const v=c-.5*l,w=h-.5*l,g=c+.5*l,T=h+.5*l,b=[];if(this.visibleFilesCount=0,f<v&&d<w&&m>g&&p>T){const t=this.selectedBucket.count;if(t>V)return;for(let e=0;e<t;e++)b.push(e)}else{d<w&&(d=w),f<v&&(f=v),p>T&&(p=T),m>g&&(m=g);const t=m-f,e=p-d,i=Math.abs(Math.floor((p-T)/u)),s=Math.abs(Math.floor((f-v)/u)),n=Math.floor(t/u),o=Math.floor(e/u);if(n*o>V)return;for(let r=0;r<n;r++)for(let t=0;t<o;t++)b.push((s+r)%a+(i+t)*a)}this.visibleFiles=b.sort((t,e)=>t-e),this.visibleFilesCount=b.length,this.loadFiles()},loadFiles(){if(!this.currentBucket)return;const t=this.currentBucket.ids;this.visibleFiles.forEach(e=>{const i=t[e],s=M+"/"+i;this.putFileInIndex(s,e)})},putFileInIndex(t,e){if(this.filesLoaded.has(e))return;const i=this.filesObject.mga.tileSize,s=new l["o"];this.filesObject.getMatrixAt(e,s);const n=new l["I"];s.decompose(n,new l["v"],new l["I"]);const o=n.x,r=n.y,a=n.z,c=new l["r"];c.position.set(o,r,a),c.scale.set(0,0,0),c.updateMatrix(),this.filesObject.setMatrixAt(e,c.matrix),this.filesObject.instanceMatrix.needsUpdate=!0;const h=(new l["G"]).load(t);h.encoding=l["L"];const u=new l["q"]({map:h}),f=new l["p"](new l["t"](i,i),u);f.position.set(o,r,a),this.filesGroup.add(f),this.filesLoaded.add(e)},cleanFiles(){this.filesLoaded=null,this.filesObject&&(this.scene.remove(this.filesObject),this.filesGroup&&(this.filesGroup.children.forEach(t=>{t.geometry.dispose(),t.material.map.dispose()}),this.scene.remove(this.filesGroup)))},paintAtlas(){console.log("painting atlases")},initFiles(t){this.cleanFiles(),this.filesLoaded=new Set;const e=this.selectedBucket.count,i=Math.ceil(Math.sqrt(e)),s=t.geometry.parameters.width,n=s/i,o=n*(K/Q),r=i*n+(i-1)*o,a=new l["c"],c="/atlas/"+this.currentBucket.key+"_0.jpg",h=(new l["G"]).load(c);h.flipY=!1;const u=new l["w"]({vertexShader:et,fragmentShader:it,uniforms:{atlases:{type:"f",value:this.showAtlases?1:0},texture:{type:"t",value:h},atlasPx:{type:"f",value:R},cellPx:{type:"f",value:N}},depthTest:!0,transparent:!0,vertexColors:!0}),f=new Float32Array(2*e);for(let l=0;l<e;l++){const t=l%B,e=Math.floor(l/B);f[2*l]=t,f[2*l+1]=e}a.setAttribute("uv",new l["b"](f,2,!0)),a.setAttribute("color",new l["i"](this.defaultColors,3)),a.setAttribute("size",new l["i"](new Float32Array(e).fill(n,0,e),1)),this.filesObject=new l["u"](a,u),this.filesObject.mga={realW:r,side:i,tileSize:n,x:t.position.x,y:t.position.y,z:t.position.z},this.scene.add(this.filesObject),this.filesGroup=new l["k"],this.scene.add(this.filesGroup)},interpolateFiles(){if(!this.filesMoveStart)return;const t=Date.now()-this.filesMoveStart;let e,i;"hue"===this.filesMoveTo?(e=this.defaultPositions,i=this.huePositions):(e=this.huePositions,i=this.defaultPositions),t>=J&&(e=i,this.filesMoveStart=null);const{realW:s,tileSize:n}=this.filesObject.mga,o=this.filesObject.mga.x-s/2+n/2,r=this.filesObject.mga.y+s/2-n/2,a=this.filesObject.mga.z,c=n*(K/Q),h=this.selectedBucket.count,u=new Float32Array(3*h),f=new l["I"];for(let l=0,d=0,m=h;l<m;l++,d+=3){const s=e[d],l=e[d+1],h=e[d+2],m=i[d],p=i[d+1],v=i[d+2];let w=ot(t,s,m-s,J),g=ot(t,l,p-l,J),T=ot(t,h,v-h,J);w=o+w*(n+c),g=r+g*-(n+c),T=a+T,f.set(w,g,T),f.toArray(u,d)}this.filesObject.geometry.setAttribute("position",new l["i"](u,3))},paintBuckets(){this.cleanBuckets();const t=Object.values(this.stuff).filter(t=>t.count>0);t.sort((t,e)=>e.count-t.count);const e=t.length,i=new Float32Array(3*e),s=new l["e"],n=new l["k"],o=new l["k"],r=Math.ceil(Math.sqrt(e)),a=-1,c=1,h=2/(r-1);for(let u=0,f=0,d=e;u<d;u++,f+=3){const e=t[u],f=e.count,m=e.name,p=f/this.itemsTotal,v=this.scaled?Math.sqrt(p):L,w=Q*v,g=a+u%r*h,T=c-Math.floor(u/r)*h,b=G;s.setHSL(.01+u/d*.1,1,.5),s.toArray(i,3*u);const x=new l["t"](w,w),E=e.images[Math.floor(Math.random()*e.images.length)],C=(new l["G"]).load(E);C.encoding=l["L"];const S=new l["q"]({map:C,color:16777215}),y=new l["p"](x,S);y.bucketIndex=e.key,y.position.set(g,T,b),n.add(y);const _=T+w/2,k=G+Z*v,I=m,M=f;o.add(at(`${I.toUpperCase()}: ${(new Intl.NumberFormat).format(M)}`,g-w/2,_,k,v))}this.bucketsGroup=n,this.textGroup=o,this.scene.add(this.bucketsGroup),this.scene.add(this.textGroup)},cleanBuckets(){this.bucketsGroup&&(this.textGroup.children.forEach(t=>t.material.map.dispose()),this.bucketsGroup.children.forEach(t=>{t.geometry.dispose(),t.material.map.dispose()}),this.scene.remove(this.bucketsGroup),this.scene.remove(this.textGroup))},moveCameraTo(t){let e;e=t instanceof l["l"]?st(t):t instanceof l["k"]?nt(t):(new l["a"]).setFromObject(t);const i=new l["C"];e.getBoundingSphere(i);const s=t instanceof l["l"]?.9*i.radius*Y:i.radius*Y,n=new l["I"];e.getCenter(n);const o=F*(Math.PI/180),r=Math.abs(s/Math.sin(o/2)),a=new l["I"](0,0,1),c=(new l["I"]).addVectors(n,a.setLength(r));this.lastCamera=this.camera.clone(),this.toCamera=this.camera.clone(),this.toCamera.position.copy(c),this.toLook=n,this.cameraMoveStart=Date.now(),this.isMoving=!0},interpolateCamera(){if(!this.lastCamera)return;const t=Date.now()-this.cameraMoveStart,e=this.lastCamera.position.x,i=this.lastCamera.position.y,s=this.lastCamera.position.z,n=this.toCamera.position.x,o=this.toCamera.position.y,r=this.toCamera.position.z,a=new l["I"];a.x=ot(t,e,n-e,J),a.y=ot(t,i,o-i,J),a.z=ot(t,s,r-s,J),this.camera.position.copy(a);const c=this.controls.target.clone(),h=this.toLook.clone(),u=new l["I"];u.x=ot(t,c.x,h.x-c.x,J),u.y=ot(t,c.y,h.y-c.y,J),u.z=ot(t,c.z,h.z-c.z,J),this.controls.target.copy(u),t>J&&(this.camera.position.copy(this.toCamera.position),this.controls.target.copy(this.toLook),this.lastCamera=null,this.toCamera=null,this.isMoving=!1)},animate(){requestAnimationFrame(this.animate),this.interpolateCamera(),this.interpolateFiles(),this.controls.update(),this.render()},onResize(){const t=window.innerWidth,e=window.innerHeight;this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e),this.pickingTexture.setSize(t,e)},onDocumentMouseOut(t){this.lastFileId=null,this.fileData={},this.$refs.file&&this.$refs.file.classList.add("hidden")},onCanvasMouseMove(t){this.renderer.setRenderTarget(this.pickingTexture),this.renderer.render(this.scene,this.camera),this.renderer.setRenderTarget(null);const e=t.clientX,i=this.pickingTexture.height-t.clientY;this.renderer.readRenderTargetPixels(this.pickingTexture,e,i,1,1,this.pixelBuffer);this.pixelBuffer[0],this.pixelBuffer[1],this.pixelBuffer[2]},onDocumentMouseMove(t){this.$refs.three&&this.$refs.three.classList.remove("pointer"),this.mouse&&this.raycaster.setFromCamera(this.mouse,this.camera),this.pickBucket(),this.pickFile(),this.lastMouseMoveId&&window.clearTimeout(this.lastMouseMoveId),this.lastMouseMoveId=window.setTimeout(this.loadFile,P),t.preventDefault(),this.mouse.x=t.clientX/window.innerWidth*2-1,this.mouse.y=-t.clientY/window.innerHeight*2+1,this.positionFile(this.PAST_INTERSECTED.fileId)},hideCursor(){this.cursor.visible=!1},render(){this.renderer.render(this.scene,this.camera)},pickFile(){if(this.filesObject&&this.fileMode){const t=[];if(t.length>0){this.$refs.three&&this.$refs.three.classList.add("pointer");const e=t[0].index;if(console.log(t[0]),this.PAST_INTERSECTED.instanceId!==e){this.fileData={};const i=t[0].point;this.PAST_INTERSECTED.instanceId=e,this.PAST_INTERSECTED.obj=i,this.PAST_INTERSECTED.fileId=this.currentBucket.ids[e]}}else this.PAST_INTERSECTED.instanceId&&(this.PAST_INTERSECTED={})}},positionFile(t){if(!this.$refs.file)return;const e=this.$refs.file;if(!t)return this.lastFileId=null,void e.classList.add("hidden");e.classList.remove("hidden");let i=window.innerWidth*(this.mouse.x+1)/2;i+U>window.innerWidth&&(i=i-U-4*q);let s=window.innerHeight*(this.mouse.y-1)/-2-U/2;s+U>window.innerHeight&&(s-=U/2),s<0&&(s=q),e.style.left=i+q+"px",e.style.top=s+q+"px"},loadFile(){if(!this.$refs.file)return;if(!this.PAST_INTERSECTED.fileId)return void(this.lastFileId=null);const t=this.PAST_INTERSECTED.fileId;if(t===this.lastFileId)return;this.fileData={},this.lastFileId=t;let e="/files/"+t;tt.get(e).then(t=>{const e=t.data.file.image.variants["300_300"].url,i=t.data.file.title;this.fileData={...this.fileData,image:e,title:i}}),e=M+"/data/"+t,tt.get(e).then(t=>{const e=t.data.palette_colors,i=e.split(",").map(t=>t.split(":")).map(t=>({color:t[0],percent:Number(t[1])}));this.fileData={...this.fileData,palette:i}})},pickBucket(){if(this.bucketsGroup&&!this.fileMode){const t=this.bucketsGroup.children.map(t=>this.raycaster.intersectObject(t)).filter(t=>t.length>0).map(t=>t[0]);if(t.length>0){this.$refs.three&&this.$refs.three.classList.add("pointer");const e=t[0].object,i=e.bucketIndex;if(this.PAST_INTERSECTED.instanceId!==i){this.selectedInstance.instanceId!==this.PAST_INTERSECTED.instanceId&&this.hideCursor(),this.PAST_INTERSECTED.instanceId=i,this.PAST_INTERSECTED.obj=e;const t=e.geometry.parameters.width/Q,s=new l["I"](e.position.x,e.position.y+.045*t,e.position.z-.001);this.cursor.position.copy(s),this.cursor.scale=new l["I"](1.02*t,1.12*t,t),this.cursor.visible=!0}}else this.PAST_INTERSECTED.instanceId&&(this.hideCursor(),this.PAST_INTERSECTED={})}},...Object(o["b"])(["getcurrentAtlases"])}},ct=lt,ht=(i("086b"),i("2877")),ut=Object(ht["a"])(ct,r,a,!1,null,"7bdbda3f",null),ft=ut.exports,dt={components:{Viz:ft},data(){return{}},watch:{$route(t){const e=t.query.sort?t.query.sort:"default";e!==this.sort&&this.$store.commit("setSort",e)}},computed:{thing(){const t=Object.values(this.stuff).length;return this.currentBucket?this.currentBucket.name.trim():Object.values(this.stuff).filter(t=>t.count>0).map((e,i)=>i===t-1?"and "+e.name:e.name).join(", ")},total(){return this.itemsTotal},formattedItemsTotal(){return(new Intl.NumberFormat).format(this.currentBucket?this.currentBucket.count:this.totalFromBuckets)},...Object(o["c"])(["totalFromBuckets"]),...Object(o["d"])(["loaded","itemsTotal","stuff","currentBucket","sort"])},created(){this.$store.commit("setSort",this.$route.query.sort),this.$store.commit("getBuckets")}},mt=dt,pt=(i("fc51"),i("295e"),Object(ht["a"])(mt,s,n,!1,null,"27862fc4",null));e["default"]=pt.exports},fc51:function(t,e,i){"use strict";var s=i("d1dc"),n=i.n(s);n.a}}]);
//# sourceMappingURL=three.0a67f8b7.js.map