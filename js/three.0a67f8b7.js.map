{"version":3,"sources":["webpack:///./src/components/Viz.vue?11bd","webpack:///./src/views/Viewer.vue?5e31","webpack:///./src/views/Viewer.vue?b8e8","webpack:///./src/components/Viz.vue?8a56","webpack:///./node_modules/three-spritetext/dist/three-spritetext.module.js","webpack:///src/components/Viz.vue","webpack:///./src/components/Viz.vue?90c1","webpack:///./src/components/Viz.vue","webpack:///src/views/Viewer.vue","webpack:///./src/views/Viewer.vue?bf42","webpack:///./src/views/Viewer.vue","webpack:///./src/views/Viewer.vue?5f72"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","formattedItemsTotal","thing","class","sort","attrs","path","query","_e","staticRenderFns","ref","fileData","_l","color","index","key","style","backgroundColor","width","percent","title","image","on","onCanvasMouseMove","$event","preventDefault","onDoubleClick","onClick","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_createClass","protoProps","staticProps","prototype","_inherits","subClass","superClass","create","constructor","value","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","p","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","call","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","arr2","iter","Symbol","iterator","toString","from","three","window","THREE","LinearFilter","Sprite","SpriteMaterial","Texture","_default","_three$Sprite","_this","text","arguments","undefined","textHeight","map","_text","concat","_textHeight","_color","_fontFace","_fontSize","_fontWeight","_canvas","document","createElement","_texture","material","minFilter","_genCanvas","_this2","canvas","ctx","getContext","lines","split","font","fontWeight","fontSize","fontFace","Math","max","apply","line","measureText","height","fillStyle","textBaseline","forEach","fillText","needsUpdate","yScale","scale","set","copy","source","get","axios","default","API_KEY","API_BASE_URL","THUMBS_BASE_URL","FILES_BASE_URL","API_CALL_DELAY","CAMERA_NEAR","CAMERA_FAR","CAMERA_FOV","CAMERA_MAX_DIST","CAMERA_MIN_DIST","ATLAS_SIZE","ATLAS_PER_SIDE","ATLAS_TILE_SIZE","BASE_SCALE","BUCKET_Z","FILE_Z","CHANGE_DELAY","COLOR_HOVERED","HOVER_PADDING","HOVER_WIDTH","MAX_VISIBLE_FILES","MOVE_DURATION","SCENE_PADDING","TEXT_SIZE","TEXT_Z","TILE_PADDING","TILE_SIZE","baseURL","headers","timeout","vShader","fShader","getBoundsFromMesh","obj","count","instanceMatrix","matrix","s","q","i3","l","getMatrixAt","decompose","x","y","z","objBucket","position","expandByObject","getBoundsFromGroup","children","child","easeInOutQuad","t","b","c","d","createBaseCamera","aspect","innerWidth","innerHeight","camera","updateProjectionMatrix","createText","isNaN","indexOf","myText","center","components","bucketsGroup","cameraMoveStart","cameraObj","controls","cursor","isMoving","lastMouseMoveId","lastChange","lastFileId","fileMode","filesGroup","filesLoaded","filesMoveFrom","filesMoveStart","filesMoveTo","filesObject","lastCamera","mouse","PAST_INTERSECTED","pickingScene","pickingTexture","pixelBuffer","raycaster","renderer","scaled","scene","showAtlases","selectedInstance","selectedBucket","textGroup","toCamera","toLook","visibleFiles","visibleFilesCount","computed","init","createControls","paintBuckets","moveCameraTo","animate","addEventListener","onResize","onDocumentMouseMove","onDocumentMouseOut","removeEventListener","watch","newB","initFiles","paintSort","getcurrentAtlases","newCount","paintAtlas","newScale","to","Date","now","methods","antialias","$refs","powerPreference","outputEncoding","gammaFactor","setPixelRatio","devicePixelRatio","setSize","background","Uint8Array","geometry","moveTo","lineTo","mesh","visible","add","gui","e","fileId","url","open","instanceId","stuff","bucketIndex","tileCount","pct","itemsTotal","sqrt","w","parameters","setTimeout","$store","commit","console","log","cleanFiles","hideCursor","TrackballControls","rotateSpeed","zoomSpeed","panSpeed","maxDistance","minDistance","noRotate","screenSpacePanning","enableDamping","dampingFactor","cx","cy","dz","h","tan","PI","side","realW","mga","tileSize","minx","miny","maxx","maxy","fminx","fminy","fmaxx","fmaxy","results","push","dx","dy","row","abs","floor","col","cc","rr","j","a","loadFiles","currentBucket","ids","idx","id","putFileInIndex","has","transform","updateMatrix","setMatrixAt","texture","load","encoding","fileMesh","remove","dispose","Set","ceil","padding","flipY","vertexShader","fragmentShader","uniforms","atlases","type","atlasPx","cellPx","depthTest","transparent","vertexColors","uvs","Float32Array","setAttribute","defaultColors","fill","defaultPositions","huePositions","positions","xF","yF","zF","xT","yT","zT","xx","yy","zz","toArray","cleanBuckets","buckets","values","filter","bucketCount","colors","xini","yini","spacing","name","setHSL","images","random","textTop","textZ","labelStr","numberStr","toUpperCase","Intl","NumberFormat","format","setFromObject","sphere","getBoundingSphere","radius","getCenter","fov","dist","sin","dir","newPos","addVectors","setLength","clone","cF","cT","requestAnimationFrame","interpolateCamera","interpolateFiles","update","event","file","classList","setRenderTarget","clientX","clientY","readRenderTargetPixels","setFromCamera","pickBucket","pickFile","clearTimeout","loadFile","positionFile","intersects","point","elem","left","top","then","response","data","variants","colorResponse","paletteStr","palette_colors","palette","Number","ch","intersectObject","object","component","Viz","trim","join","totalFromBuckets","$route"],"mappings":"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","file":"js/three.0a67f8b7.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viz.vue?vue&type=style&index=0&id=7bdbda3f&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viz.vue?vue&type=style&index=0&id=7bdbda3f&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=style&index=1&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=style&index=1&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.loaded)?_c('div',{staticClass:\"grid\"},[_c('div',{staticClass:\"header\"},[_c('h1',{staticClass:\"total\"},[_c('strong',[_vm._v(_vm._s(_vm.formattedItemsTotal))]),_vm._v(\" \"+_vm._s(_vm.thing)+\". \")])]),_c('div',{staticClass:\"sort\"},[_c('router-link',{class:['sort-button', _vm.sort === 'default' ? 'active' : ''],attrs:{\"to\":{ path: '/' }}},[_vm._v(\" default \")]),_c('router-link',{class:['sort-button', _vm.sort === 'hue' ? 'active' : ''],attrs:{\"to\":{ path: '/', query: { sort: 'hue' } }}},[_vm._v(\" color \")])],1),_c('viz',{staticClass:\"viz\"})],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"three\"},[_c('div',{ref:\"file\",staticClass:\"file hidden\"},[(_vm.fileData.palette)?_c('div',{staticClass:\"palette\"},_vm._l((_vm.fileData.palette),function(color,index){return _c('span',{key:index,staticClass:\"color\",style:({\n          backgroundColor: color.color,\n          width: color.percent * 100 + '%'\n        })})}),0):_vm._e(),(!_vm.fileData.title)?_c('div',{staticClass:\"loading\"},[_vm._v(\"Loading...\")]):_vm._e(),(_vm.fileData.image)?_c('img',{staticClass:\"thumbnail\",attrs:{\"src\":_vm.fileData.image,\"alt\":\"\"}}):_vm._e(),(_vm.fileData.title)?_c('p',[_vm._v(_vm._s(_vm.fileData.title))]):_vm._e()]),_c('canvas',{ref:\"three\",staticClass:\"three\",on:{\"mousemove\":_vm.onCanvasMouseMove,\"dblclick\":function($event){$event.preventDefault();return _vm.onDoubleClick($event)},\"click\":function($event){$event.preventDefault();return _vm.onClick($event)}}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { LinearFilter, Sprite, SpriteMaterial, Texture } from 'three';\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  LinearFilter: LinearFilter,\n  Sprite: Sprite,\n  SpriteMaterial: SpriteMaterial,\n  Texture: Texture\n};\n\nvar _default =\n/*#__PURE__*/\nfunction (_three$Sprite) {\n  _inherits(_default, _three$Sprite);\n\n  function _default() {\n    var _this;\n\n    var text = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var textHeight = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;\n    var color = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'rgba(255, 255, 255, 1)';\n\n    _classCallCheck(this, _default);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(_default).call(this, new three.SpriteMaterial({\n      map: new three.Texture()\n    })));\n    _this._text = \"\".concat(text);\n    _this._textHeight = textHeight;\n    _this._color = color;\n    _this._fontFace = 'Arial';\n    _this._fontSize = 90; // defines text resolution\n\n    _this._fontWeight = 'normal';\n    _this._canvas = document.createElement('canvas');\n    _this._texture = _this.material.map;\n    _this._texture.minFilter = three.LinearFilter;\n\n    _this._genCanvas();\n\n    return _this;\n  }\n\n  _createClass(_default, [{\n    key: \"_genCanvas\",\n    value: function _genCanvas() {\n      var _this2 = this;\n\n      var canvas = this._canvas;\n      var ctx = canvas.getContext('2d');\n\n      var lines = this._text.split('\\n');\n\n      var font = \"\".concat(this.fontWeight, \" \").concat(this.fontSize, \"px \").concat(this.fontFace);\n      ctx.font = font; // measure canvas with appropriate font\n\n      canvas.width = Math.max.apply(Math, _toConsumableArray(lines.map(function (line) {\n        return ctx.measureText(line).width;\n      })));\n      canvas.height = this.fontSize * lines.length; // Set font again after canvas is resized, as context properties are reset\n\n      ctx.font = font;\n      ctx.fillStyle = this.color;\n      ctx.textBaseline = 'bottom';\n      lines.forEach(function (line, index) {\n        return ctx.fillText(line, (canvas.width - ctx.measureText(line).width) / 2, (index + 1) * _this2.fontSize);\n      }); // Inject canvas into sprite\n\n      this._texture.image = canvas;\n      this._texture.needsUpdate = true;\n      var yScale = this.textHeight * lines.length;\n      this.scale.set(yScale * canvas.width / canvas.height, yScale);\n    }\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      return new this.constructor(this.text, this.textHeight, this.color).copy(this);\n    }\n  }, {\n    key: \"copy\",\n    value: function copy(source) {\n      three.Sprite.prototype.copy.call(this, source);\n      this.color = source.color;\n      this.fontFace = source.fontFace;\n      this.fontSize = source.fontSize;\n      this.fontWeight = source.fontWeight;\n      return this;\n    }\n  }, {\n    key: \"text\",\n    get: function get() {\n      return this._text;\n    },\n    set: function set(text) {\n      this._text = text;\n\n      this._genCanvas();\n    }\n  }, {\n    key: \"textHeight\",\n    get: function get() {\n      return this._textHeight;\n    },\n    set: function set(textHeight) {\n      this._textHeight = textHeight;\n\n      this._genCanvas();\n    }\n  }, {\n    key: \"color\",\n    get: function get() {\n      return this._color;\n    },\n    set: function set(color) {\n      this._color = color;\n\n      this._genCanvas();\n    }\n  }, {\n    key: \"fontFace\",\n    get: function get() {\n      return this._fontFace;\n    },\n    set: function set(fontFace) {\n      this._fontFace = fontFace;\n\n      this._genCanvas();\n    }\n  }, {\n    key: \"fontSize\",\n    get: function get() {\n      return this._fontSize;\n    },\n    set: function set(fontSize) {\n      this._fontSize = fontSize;\n\n      this._genCanvas();\n    }\n  }, {\n    key: \"fontWeight\",\n    get: function get() {\n      return this._fontWeight;\n    },\n    set: function set(fontWeight) {\n      this._fontWeight = fontWeight;\n\n      this._genCanvas();\n    }\n  }]);\n\n  return _default;\n}(three.Sprite);\n\nexport default _default;\n","<template>\n  <div class=\"three\">\n    <div class=\"file hidden\" ref=\"file\">\n      <div v-if=\"fileData.palette\" class=\"palette\">\n        <span\n          class=\"color\"\n          v-for=\"(color, index) in fileData.palette\"\n          :key=\"index\"\n          :style=\"{\n            backgroundColor: color.color,\n            width: color.percent * 100 + '%'\n          }\"\n        ></span>\n      </div>\n      <div class=\"loading\" v-if=\"!fileData.title\">Loading...</div>\n      <img\n        v-if=\"fileData.image\"\n        :src=\"fileData.image\"\n        alt=\"\"\n        class=\"thumbnail\"\n      />\n      <p v-if=\"fileData.title\">{{ fileData.title }}</p>\n    </div>\n    <canvas\n      ref=\"three\"\n      class=\"three\"\n      @mousemove=\"onCanvasMouseMove\"\n      @dblclick.prevent=\"onDoubleClick\"\n      @click.prevent=\"onClick\"\n    ></canvas>\n  </div>\n</template>\n\n<script>\n/* eslint-disable no-console */\nconst axios = require('axios').default\n\nimport { mapState, mapGetters, mapActions } from 'vuex'\n\nimport * as THREE from 'three'\nimport { GUI } from 'three/examples/jsm/libs/dat.gui.module.js'\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls.js'\nimport SpriteText from 'three-spritetext'\n\n// api stuff\nconst API_KEY = process.env.VUE_APP_API_KEY\nconst API_BASE_URL = process.env.VUE_APP_API_BASE_URL\nconst THUMBS_BASE_URL = process.env.VUE_APP_THUMBS_BASE_URL\nconst FILES_BASE_URL = process.env.VUE_APP_FILES_BASE_URL\nconst API_CALL_DELAY = 500 // ms to wait before hitting api\n\n// camera stuff\nconst CAMERA_NEAR = 0.001\nconst CAMERA_FAR = 10\nconst CAMERA_FOV = 45\nconst CAMERA_MAX_DIST = 4\nconst CAMERA_MIN_DIST = 0\n\n// tile stuff\nconst ATLAS_SIZE = 2048\nconst ATLAS_PER_SIDE = 64\nconst ATLAS_TILE_SIZE = 32\nconst BASE_SCALE = 0.49\nconst BUCKET_Z = 1\nconst FILE_Z = 0.003\nconst CHANGE_DELAY = 1000 // how often to load images on pan/zoom (ms)\nconst COLOR_HOVERED = new THREE.Color('hsl(3.6, 100%, 29%)')\nconst HOVER_PADDING = 10\nconst HOVER_WIDTH = 300\nconst MAX_VISIBLE_FILES = 1000\nconst MOVE_DURATION = 300\nconst SCENE_PADDING = 1.0\nconst TEXT_SIZE = 0.06\nconst TEXT_Z = 0 // relative\nconst TILE_PADDING = 0.03125\nconst TILE_SIZE = 0.9\n\nconst instance = axios.create({\n  baseURL: API_BASE_URL,\n  headers: { 'x-api-key': API_KEY },\n  timeout: 10000\n})\n\nconst vShader = `\nprecision mediump float;\n\n// these come built in with three.js; they're basically always used in the same way (see below)\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec3 cameraPosition;\n\n// these are uniforms we specified\nuniform float atlasPx;\nuniform float cellPx;\nuniform float pointScale;\nuniform float atlases;\n\n// these are the buffer attributes we specified when creating the geometry\nattribute vec3 position;\nattribute vec2 uv;\n\n// these are attributes we will pass from the vertex to the fragment shader\nvarying vec2 vUv;\nvarying float vAtlases;\n\nattribute float size;\nattribute vec3 color;\nvarying vec3 vColor;\n\nvoid main() {\n  vColor = color;\n  vAtlases = atlases;\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n  gl_PointSize = size * ( 1400.0 / -mvPosition.z );\n  gl_Position = projectionMatrix * mvPosition;\n\n  // pass the varying data to the fragment shader\n  vUv = uv;\n}\n`\n\nconst fShader = `\nprecision mediump float;\n\nuniform sampler2D texture;\nuniform float atlasPx;\nuniform float cellPx;\n\nvarying vec2 vUv;\nvarying float vAtlases;\nvarying vec3 vColor;\n\nvoid main() {\n  vec2 uv = (vUv * cellPx + gl_PointCoord.xy * cellPx) / atlasPx;\n\n  if (vAtlases > 0.5) {\n    gl_FragColor = texture2D(texture, uv);\n    } else {\n    gl_FragColor = vec4(vColor, 1.0);\n  }\n\n  // this line mixes the actual texture color with some red\n  //gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), 0.5);\n}\n`\n\nconst getBoundsFromMesh = (obj) => {\n  const o = new THREE.Box3()\n  const count = obj.instanceMatrix.count\n  const matrix = new THREE.Matrix4()\n  const p = new THREE.Vector3()\n  const s = new THREE.Vector3()\n  const q = new THREE.Quaternion()\n  for (let i = 0, i3 = 0, l = count; i < l; i++, i3 += 3) {\n    obj.getMatrixAt(i, matrix)\n    matrix.decompose(p, q, s)\n    const x = p.x\n    const y = p.y\n    const z = p.z\n    const objBucket = new THREE.Mesh(\n      new THREE.PlaneBufferGeometry(TILE_SIZE * s.x, TILE_SIZE * s.x)\n    )\n    objBucket.position.set(x, y, z * s.x)\n    o.expandByObject(objBucket)\n  }\n  return o\n}\n\nconst getBoundsFromGroup = (obj) => {\n  const o = new THREE.Box3()\n  const count = obj.children.length\n  for (let i = 0, l = count; i < l; i++) {\n    const child = obj.children[i]\n    o.expandByObject(child)\n  }\n  return o\n}\n\nconst easeInOutQuad = (t, b, c, d) => {\n  // t: current time, b: beginning value, c: change In value, d: duration\n  if ((t /= d / 2) < 1) return (c / 2) * t * t + b\n  return (-c / 2) * (--t * (t - 2) - 1) + b\n}\n\nconst createBaseCamera = () => {\n  const aspect = window.innerWidth / window.innerHeight\n  const camera = new THREE.PerspectiveCamera(\n    CAMERA_FOV,\n    aspect,\n    CAMERA_NEAR,\n    CAMERA_FAR\n  )\n  camera.position.x = 0\n  camera.position.y = 0\n  camera.position.z = BUCKET_Z + 10\n  camera.updateProjectionMatrix()\n  return camera\n}\n\nconst createText = (text, x, y, z, scale) => {\n  text = text ? text : '[undefined]'\n  if (isNaN(text) && text.indexOf('|||') !== -1) text = text.split('|||')[1]\n  const myText = new SpriteText(text)\n  myText.fontFace = 'Space Mono'\n  myText.textHeight = TEXT_SIZE * scale\n  myText.position.set(x, y, z)\n  myText.center = new THREE.Vector2(0, 0)\n  return myText\n}\n\nexport default {\n  components: {},\n  data() {\n    return {\n      bucketsGroup: null,\n      camera: null,\n      cameraMoveStart: null,\n      cameraObj: null,\n      controls: null,\n      cursor: null,\n      isMoving: false,\n      lastMouseMoveId: null,\n      lastChange: 0,\n      lastFileId: null,\n      fileData: {},\n      fileMode: false,\n      filesGroup: null,\n      filesLoaded: null,\n      filesMoveFrom: null,\n      filesMoveStart: null,\n      filesMoveTo: null,\n      filesObject: null,\n      lastCamera: null,\n      mouse: {},\n      PAST_INTERSECTED: {},\n      pickingScene: null,\n      pickingTexture: null,\n      pixelBuffer: null,\n      raycaster: null,\n      renderer: null,\n      scaled: false,\n      scene: null,\n      showAtlases: false,\n      selectedInstance: {},\n      selectedBucket: null,\n      textGroup: null,\n      toCamera: null,\n      toLook: null,\n      visibleFiles: [],\n      visibleFilesCount: 0\n    }\n  },\n  computed: {\n    ...mapGetters(['totalFromBuckets']),\n    ...mapState([\n      'defaultPositions',\n      'defaultColors',\n      'huePositions',\n      'atlases',\n      'loadedAtlas',\n      'currentBucket',\n      'itemsTotal',\n      'sort',\n      'stuff'\n    ])\n  },\n  mounted() {\n    this.init()\n    this.createControls()\n    this.paintBuckets()\n    this.moveCameraTo(this.bucketsGroup)\n    this.animate()\n    window.addEventListener('resize', this.onResize)\n    document.addEventListener('mousemove', this.onDocumentMouseMove)\n    document.addEventListener('mouseout', this.onDocumentMouseOut)\n  },\n  beforeDestroy() {\n    // Unregister resize before destroying this Vue instance\n    window.removeEventListener('resize', this.onResize)\n    document.removeEventListener('mousemove', this.onDocumentMouseMove)\n    document.removeEventListener('mouseout', this.onDocumentMouseOut)\n  },\n  watch: {\n    currentBucket(newB) {\n      if (newB) {\n        if (this.cameraObj) {\n          this.initFiles(this.cameraObj)\n          this.paintSort()\n        }\n        this.getcurrentAtlases()\n      }\n    },\n    loadedAtlas(newCount) {\n      if (newCount === 0) this.paintAtlas()\n    },\n    scaled(newScale) {\n      // console.log(newScale)\n    },\n    sort(to, from) {\n      this.filesMoveStart = Date.now()\n      this.filesMoveFrom = from\n      this.filesMoveTo = to\n    }\n  },\n  methods: {\n    paintSort() {\n      if (!this.filesObject) return\n      this.filesMoveStart = Date.now() - MOVE_DURATION\n      this.filesMoveTo = this.sort\n    },\n    init() {\n      this.renderer = new THREE.WebGLRenderer({\n        antialias: true,\n        canvas: this.$refs.three,\n        powerPreference: 'high-performance'\n      }) // false improves the frame rate\n      this.renderer.outputEncoding = THREE.sRGBEncoding\n      this.renderer.gammaFactor = 2.2\n      this.renderer.setPixelRatio(window.devicePixelRatio)\n\n      this.renderer.setSize(window.innerWidth, window.innerHeight)\n\n      this.scene = new THREE.Scene()\n      this.scene.background = new THREE.Color('hsl(0, 0%, 15%)')\n\n      this.raycaster = new THREE.Raycaster()\n      this.mouse = new THREE.Vector2(-1e10, -1e10) // init far outside the canvas\n\n      // file picking scene\n      this.pickingScene = new THREE.Scene()\n      this.pickingScene.background = new THREE.Color(0x000000)\n      // must be identical to the size of the drawn scene\n      this.pickingTexture = new THREE.WebGLRenderTarget(\n        window.innerWidth,\n        window.innerHeight\n      )\n      this.pixelBuffer = new Uint8Array(4)\n\n      this.camera = createBaseCamera()\n\n      // cursor\n      const geometry = new THREE.ShapeBufferGeometry(\n        new THREE.Shape()\n          .moveTo(TILE_SIZE / 2, TILE_SIZE / 2)\n          .lineTo(TILE_SIZE / 2, -TILE_SIZE / 2)\n          .lineTo(-TILE_SIZE / 2, -TILE_SIZE / 2)\n          .lineTo(-TILE_SIZE / 2, TILE_SIZE / 2)\n          .lineTo(TILE_SIZE / 2, TILE_SIZE / 2)\n      )\n      const material = new THREE.MeshBasicMaterial({\n        color: COLOR_HOVERED\n      })\n      const mesh = new THREE.Mesh(geometry, material)\n      mesh.visible = false\n      this.cursor = mesh\n      this.scene.add(this.cursor)\n\n      const gui = new GUI()\n\n      gui.add(this, 'showAtlases')\n    },\n    onDoubleClick(e) {\n      if (this.fileMode) {\n        if (this.PAST_INTERSECTED.fileId !== undefined) {\n          // double-clicked a file\n          const url = FILES_BASE_URL + '/' + this.PAST_INTERSECTED.fileId\n          window.open(url, '_blank')\n        }\n        return\n      }\n      if (this.PAST_INTERSECTED.instanceId !== undefined) {\n        this.selectedBucket = this.stuff[this.PAST_INTERSECTED.obj.bucketIndex]\n        const tileCount = this.selectedBucket.count\n        const pct = tileCount / this.itemsTotal\n        const scale = this.scaled ? BASE_SCALE : Math.sqrt(pct)\n        const x = this.PAST_INTERSECTED.obj.position.x\n        const y = this.PAST_INTERSECTED.obj.position.y\n        const w = this.PAST_INTERSECTED.obj.geometry.parameters.width * scale\n        const obj = new THREE.Mesh(new THREE.PlaneBufferGeometry(w, w))\n        obj.position.set(x, y, FILE_Z)\n        this.moveCameraTo(obj)\n        this.fileMode = true\n        this.cameraObj = obj\n        window.setTimeout(() => (this.PAST_INTERSECTED = {}), 100)\n        this.$store.commit('setBucket', this.selectedBucket)\n      }\n    },\n    onClick() {\n      console.log('click', this.PAST_INTERSECTED)\n      if (this.isMoving) return\n      if (this.fileMode) {\n        if (this.PAST_INTERSECTED.instanceId === undefined) {\n          // clicked outside\n          console.log('outside')\n          this.fileMode = false\n          this.cleanFiles()\n          this.moveCameraTo(this.selectedInstance.obj)\n          this.$store.commit('setBucket', null)\n        } else {\n          // clicked a file\n          console.log('file')\n          const p = new THREE.Object3D()\n          p.position.set(this.PAST_INTERSECTED.obj)\n          this.moveCameraTo(p)\n        }\n        return\n      }\n      if (this.PAST_INTERSECTED.instanceId !== undefined) {\n        // there is a selected bucket\n        if (\n          this.PAST_INTERSECTED.instanceId !== this.selectedInstance.instanceId\n        ) {\n          console.log('bucket')\n          this.hideCursor()\n          this.moveCameraTo(this.PAST_INTERSECTED.obj)\n          this.selectedInstance = { ...this.PAST_INTERSECTED }\n        }\n      } else {\n        console.log('main')\n        this.moveCameraTo(this.bucketsGroup)\n        this.hideCursor()\n        this.selectedInstance = {}\n        this.fileMode = false\n      }\n      this.$store.commit('setBucket', null)\n    },\n    createControls() {\n      this.controls = new TrackballControls(this.camera, this.$refs.three)\n      this.controls.rotateSpeed = 1.0\n      this.controls.zoomSpeed = 1\n      this.controls.panSpeed = 1\n      this.controls.maxDistance = CAMERA_MAX_DIST\n      this.controls.minDistance = CAMERA_MIN_DIST\n      // this.controls.mouseButtons.LEFT = THREE.MOUSE.PAN\n      // this.controls.mouseButtons.RIGHT = THREE.MOUSE.ROTATE\n      this.controls.noRotate = true\n      this.controls.screenSpacePanning = true\n      this.controls.enableDamping = true\n      this.controls.dampingFactor = 0.1\n    },\n    filesInView() {\n      if (!this.fileMode || !this.filesObject) return\n      const now = Date.now()\n      if (now - this.lastChange < CHANGE_DELAY) return\n      this.lastChange = now\n      const cx = this.camera.position.x\n      const cy = this.camera.position.y\n      const dz = this.camera.position.z - FILE_Z\n      const aspect = this.camera.aspect\n      const h = 2 * dz * Math.tan(CAMERA_FOV * 0.5 * (Math.PI / 180))\n      const w = h * aspect\n      const { side, realW, x, y } = this.filesObject.mga\n      const tileSize = realW / side\n      let minx = cx - w * 0.5\n      let miny = cy - h * 0.5\n      let maxx = cx + w * 0.5\n      let maxy = cy + h * 0.5\n      const fminx = x - realW * 0.5\n      const fminy = y - realW * 0.5\n      const fmaxx = x + realW * 0.5\n      const fmaxy = y + realW * 0.5\n      const results = []\n      this.visibleFilesCount = 0\n      if (minx < fminx && miny < fminy && maxx > fmaxx && maxy > fmaxy) {\n        // all the things\n        const l = this.selectedBucket.count\n        if (l > MAX_VISIBLE_FILES) return\n        for (let i = 0; i < l; i++) {\n          results.push(i)\n        }\n      } else {\n        // a subset of things\n        if (miny < fminy) miny = fminy\n        if (minx < fminx) minx = fminx\n        if (maxy > fmaxy) maxy = fmaxy\n        if (maxx > fmaxx) maxx = fmaxx\n        const dx = maxx - minx\n        const dy = maxy - miny\n        const row = Math.abs(Math.floor((maxy - fmaxy) / tileSize))\n        const col = Math.abs(Math.floor((minx - fminx) / tileSize))\n        const cc = Math.floor(dx / tileSize)\n        const rr = Math.floor(dy / tileSize)\n        if (cc * rr > MAX_VISIBLE_FILES) return\n        for (let i = 0; i < cc; i++) {\n          for (let j = 0; j < rr; j++) {\n            results.push(((col + i) % side) + (row + j) * side)\n          }\n        }\n      }\n      this.visibleFiles = results.sort((a, b) => a - b)\n      this.visibleFilesCount = results.length\n      this.loadFiles()\n    },\n    loadFiles() {\n      if (!this.currentBucket) return\n      const ids = this.currentBucket.ids\n      this.visibleFiles.forEach((idx) => {\n        const id = ids[idx]\n        const url = THUMBS_BASE_URL + '/' + id\n        this.putFileInIndex(url, idx)\n      })\n    },\n    putFileInIndex(url, idx) {\n      if (this.filesLoaded.has(idx)) return\n      const tileSize = this.filesObject.mga.tileSize\n\n      const matrix = new THREE.Matrix4()\n      this.filesObject.getMatrixAt(idx, matrix)\n\n      const p = new THREE.Vector3()\n      matrix.decompose(p, new THREE.Quaternion(), new THREE.Vector3())\n      const x = p.x\n      const y = p.y\n      const z = p.z\n\n      const transform = new THREE.Object3D()\n      transform.position.set(x, y, z)\n      transform.scale.set(0, 0, 0)\n      transform.updateMatrix()\n      this.filesObject.setMatrixAt(idx, transform.matrix)\n      this.filesObject.instanceMatrix.needsUpdate = true\n\n      const texture = new THREE.TextureLoader().load(url)\n      texture.encoding = THREE.sRGBEncoding\n\n      const material = new THREE.MeshBasicMaterial({ map: texture })\n\n      const fileMesh = new THREE.Mesh(\n        new THREE.PlaneBufferGeometry(tileSize, tileSize),\n        material\n      )\n      fileMesh.position.set(x, y, z)\n      this.filesGroup.add(fileMesh)\n      this.filesLoaded.add(idx)\n    },\n    cleanFiles() {\n      this.filesLoaded = null\n      if (!this.filesObject) return\n      this.scene.remove(this.filesObject)\n      if (!this.filesGroup) return\n      this.filesGroup.children.forEach((t) => {\n        t.geometry.dispose()\n        t.material.map.dispose()\n      })\n      this.scene.remove(this.filesGroup)\n    },\n    paintAtlas() {\n      console.log('painting atlases')\n    },\n    initFiles(obj) {\n      this.cleanFiles()\n\n      this.filesLoaded = new Set()\n\n      const tileCount = this.selectedBucket.count\n      const side = Math.ceil(Math.sqrt(tileCount))\n      const w = obj.geometry.parameters.width\n      const tileSize = w / side\n      const padding = tileSize * (TILE_PADDING / TILE_SIZE)\n      const realW = side * tileSize + (side - 1) * padding\n\n      const geometry = new THREE.BufferGeometry()\n\n      const url = '/atlas/' + this.currentBucket.key + '_0.jpg'\n      const texture = new THREE.TextureLoader().load(url)\n      texture.flipY = false\n\n      const material = new THREE.RawShaderMaterial({\n        vertexShader: vShader,\n        fragmentShader: fShader,\n        uniforms: {\n          atlases: {\n            type: 'f',\n            value: this.showAtlases ? 1.0 : 0.0\n          },\n          texture: {\n            type: 't',\n            value: texture\n          },\n          atlasPx: {\n            type: 'f',\n            value: ATLAS_SIZE\n          },\n          cellPx: {\n            type: 'f',\n            value: ATLAS_TILE_SIZE\n          }\n        },\n        depthTest: true,\n        transparent: true,\n        vertexColors: true\n      })\n\n      const uvs = new Float32Array(tileCount * 2)\n\n      for (let i = 0; i < tileCount; i++) {\n        const x = i % ATLAS_PER_SIDE\n        const y = Math.floor(i / ATLAS_PER_SIDE)\n        uvs[i * 2] = x\n        uvs[i * 2 + 1] = y\n      }\n\n      geometry.setAttribute('uv', new THREE.BufferAttribute(uvs, 2, true))\n\n      geometry.setAttribute(\n        'color',\n        new THREE.Float32BufferAttribute(this.defaultColors, 3)\n      )\n\n      geometry.setAttribute(\n        'size',\n        new THREE.Float32BufferAttribute(\n          new Float32Array(tileCount).fill(tileSize, 0, tileCount),\n          1\n        )\n      )\n\n      this.filesObject = new THREE.Points(geometry, material)\n\n      // an mga object to hold the bucket file real world data\n      this.filesObject.mga = {\n        realW,\n        side,\n        tileSize,\n        x: obj.position.x,\n        y: obj.position.y,\n        z: obj.position.z\n      }\n\n      this.scene.add(this.filesObject)\n      this.filesGroup = new THREE.Group()\n      this.scene.add(this.filesGroup)\n    },\n    interpolateFiles() {\n      if (!this.filesMoveStart) return\n      const t = Date.now() - this.filesMoveStart\n      let from, to\n      if (this.filesMoveTo === 'hue') {\n        from = this.defaultPositions\n        to = this.huePositions\n      } else {\n        from = this.huePositions\n        to = this.defaultPositions\n      }\n      if (t >= MOVE_DURATION) {\n        from = to\n        this.filesMoveStart = null\n      }\n\n      const { realW, tileSize } = this.filesObject.mga\n      const x = this.filesObject.mga.x - realW / 2 + tileSize / 2\n      const y = this.filesObject.mga.y + realW / 2 - tileSize / 2\n      const z = this.filesObject.mga.z\n\n      const padding = tileSize * (TILE_PADDING / TILE_SIZE)\n\n      const tileCount = this.selectedBucket.count\n\n      const positions = new Float32Array(tileCount * 3)\n      const position = new THREE.Vector3()\n\n      for (let i = 0, i3 = 0, l = tileCount; i < l; i++, i3 += 3) {\n        const xF = from[i3]\n        const yF = from[i3 + 1]\n        const zF = from[i3 + 2]\n        const xT = to[i3]\n        const yT = to[i3 + 1]\n        const zT = to[i3 + 2]\n        let xx = easeInOutQuad(t, xF, xT - xF, MOVE_DURATION)\n        let yy = easeInOutQuad(t, yF, yT - yF, MOVE_DURATION)\n        let zz = easeInOutQuad(t, zF, zT - zF, MOVE_DURATION)\n\n        xx = x + xx * (tileSize + padding)\n        yy = y + yy * -(tileSize + padding)\n        zz = z + zz\n        position.set(xx, yy, zz)\n        position.toArray(positions, i3)\n      }\n      this.filesObject.geometry.setAttribute(\n        'position',\n        new THREE.Float32BufferAttribute(positions, 3)\n      )\n    },\n    paintBuckets() {\n      this.cleanBuckets()\n\n      const buckets = Object.values(this.stuff).filter((b) => b.count > 0)\n      buckets.sort((a, b) => b.count - a.count)\n\n      const bucketCount = buckets.length\n      const colors = new Float32Array(bucketCount * 3)\n      const color = new THREE.Color()\n      const bucketsGroup = new THREE.Group()\n      const textGroup = new THREE.Group()\n      const side = Math.ceil(Math.sqrt(bucketCount))\n      const xini = -1\n      const yini = 1\n      const spacing = 2 / (side - 1)\n\n      for (let i = 0, i3 = 0, l = bucketCount; i < l; i++, i3 += 3) {\n        const b = buckets[i]\n        const count = b.count\n        const text = b.name\n        const pct = count / this.itemsTotal\n        const scale = this.scaled ? Math.sqrt(pct) : BASE_SCALE\n        const w = TILE_SIZE * scale\n        const x = xini + (i % side) * spacing\n        const y = yini - Math.floor(i / side) * spacing\n        const z = BUCKET_Z\n\n        color.setHSL(0.01 + 0.1 * (i / l), 1.0, 0.5)\n        color.toArray(colors, i * 3)\n\n        // thumb\n        const geometry = new THREE.PlaneBufferGeometry(w, w)\n        const url = b.images[Math.floor(Math.random() * b.images.length)]\n        const texture = new THREE.TextureLoader().load(url)\n        texture.encoding = THREE.sRGBEncoding\n        const material = new THREE.MeshBasicMaterial({\n          map: texture,\n          color: 0xffffff\n        })\n        const mesh = new THREE.Mesh(geometry, material)\n        mesh.bucketIndex = b.key\n        mesh.position.set(x, y, z)\n        bucketsGroup.add(mesh)\n\n        // text particles\n        const textTop = y + w / 2\n        const textZ = BUCKET_Z + TEXT_Z * scale\n        const labelStr = text\n        const numberStr = count\n        textGroup.add(\n          createText(\n            `${labelStr.toUpperCase()}: ${new Intl.NumberFormat().format(\n              numberStr\n            )}`,\n            x - w / 2,\n            textTop,\n            textZ,\n            scale\n          )\n        )\n      }\n\n      this.bucketsGroup = bucketsGroup\n\n      this.textGroup = textGroup\n\n      this.scene.add(this.bucketsGroup)\n      this.scene.add(this.textGroup)\n    },\n    cleanBuckets() {\n      if (!this.bucketsGroup) return\n      this.textGroup.children.forEach((t) => t.material.map.dispose())\n      this.bucketsGroup.children.forEach((t) => {\n        t.geometry.dispose()\n        t.material.map.dispose()\n      })\n      this.scene.remove(this.bucketsGroup)\n      this.scene.remove(this.textGroup)\n    },\n    moveCameraTo(obj) {\n      let o\n\n      if (obj instanceof THREE.InstancedMesh) {\n        o = getBoundsFromMesh(obj)\n      } else if (obj instanceof THREE.Group) {\n        // centering on the current base bucket\n        o = getBoundsFromGroup(obj)\n      } else {\n        o = new THREE.Box3().setFromObject(obj)\n      }\n\n      const sphere = new THREE.Sphere()\n      o.getBoundingSphere(sphere)\n      const side =\n        obj instanceof THREE.InstancedMesh\n          ? sphere.radius * 0.9 * SCENE_PADDING\n          : sphere.radius * SCENE_PADDING\n\n      const center = new THREE.Vector3()\n      o.getCenter(center)\n\n      const fov = CAMERA_FOV * (Math.PI / 180)\n      const dist = Math.abs(side / Math.sin(fov / 2))\n\n      const dir = new THREE.Vector3(0, 0, 1)\n      const newPos = new THREE.Vector3().addVectors(center, dir.setLength(dist))\n\n      this.lastCamera = this.camera.clone()\n      this.toCamera = this.camera.clone()\n      this.toCamera.position.copy(newPos)\n      this.toLook = center\n\n      this.cameraMoveStart = Date.now()\n      this.isMoving = true\n    },\n    interpolateCamera() {\n      if (!this.lastCamera) return\n      const t = Date.now() - this.cameraMoveStart\n\n      const xF = this.lastCamera.position.x\n      const yF = this.lastCamera.position.y\n      const zF = this.lastCamera.position.z\n      const xT = this.toCamera.position.x\n      const yT = this.toCamera.position.y\n      const zT = this.toCamera.position.z\n      const newPos = new THREE.Vector3()\n      newPos.x = easeInOutQuad(t, xF, xT - xF, MOVE_DURATION)\n      newPos.y = easeInOutQuad(t, yF, yT - yF, MOVE_DURATION)\n      newPos.z = easeInOutQuad(t, zF, zT - zF, MOVE_DURATION)\n      this.camera.position.copy(newPos)\n\n      const cF = this.controls.target.clone()\n      const cT = this.toLook.clone()\n      const center = new THREE.Vector3()\n      center.x = easeInOutQuad(t, cF.x, cT.x - cF.x, MOVE_DURATION)\n      center.y = easeInOutQuad(t, cF.y, cT.y - cF.y, MOVE_DURATION)\n      center.z = easeInOutQuad(t, cF.z, cT.z - cF.z, MOVE_DURATION)\n      this.controls.target.copy(center)\n\n      if (t > MOVE_DURATION) {\n        this.camera.position.copy(this.toCamera.position)\n        this.controls.target.copy(this.toLook)\n        this.lastCamera = null\n        this.toCamera = null\n        this.isMoving = false\n      }\n    },\n    animate() {\n      requestAnimationFrame(this.animate)\n      this.interpolateCamera()\n      this.interpolateFiles()\n      this.controls.update()\n      this.render()\n    },\n    onResize() {\n      const w = window.innerWidth\n      const h = window.innerHeight\n      this.camera.aspect = w / h\n      this.camera.updateProjectionMatrix()\n      this.renderer.setSize(w, h)\n      this.pickingTexture.setSize(w, h)\n    },\n    onDocumentMouseOut(event) {\n      this.lastFileId = null\n      this.fileData = {}\n      if (this.$refs.file) this.$refs.file.classList.add('hidden')\n    },\n    onCanvasMouseMove(e) {\n      // render the picking scene\n      this.renderer.setRenderTarget(this.pickingTexture)\n      this.renderer.render(this.scene, this.camera)\n      this.renderer.setRenderTarget(null)\n\n      const x = e.clientX\n      const y = this.pickingTexture.height - e.clientY\n\n      // read the selected pixel\n      this.renderer.readRenderTargetPixels(\n        this.pickingTexture,\n        x,\n        y,\n        1,\n        1,\n        this.pixelBuffer\n      )\n\n      const id =\n        (this.pixelBuffer[0] << 16) |\n        (this.pixelBuffer[1] << 8) |\n        this.pixelBuffer[2]\n\n      // console.log(\n      //   id - 1 >= 0\n      //     ? 'You are hovering point ' + (id - 1).toString()\n      //     : 'You are hovering point',\n      //   x,\n      //   y,\n      //   this.pixelBuffer\n      // )\n    },\n    onDocumentMouseMove(event) {\n      if (this.$refs.three) this.$refs.three.classList.remove('pointer')\n\n      if (this.mouse) this.raycaster.setFromCamera(this.mouse, this.camera)\n\n      this.pickBucket()\n      this.pickFile()\n\n      if (this.lastMouseMoveId) window.clearTimeout(this.lastMouseMoveId)\n      this.lastMouseMoveId = window.setTimeout(this.loadFile, API_CALL_DELAY)\n      event.preventDefault()\n      this.mouse.x = (event.clientX / window.innerWidth) * 2 - 1\n      this.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1\n      this.positionFile(this.PAST_INTERSECTED.fileId)\n    },\n    hideCursor() {\n      this.cursor.visible = false\n    },\n    render() {\n      // this.filesInView()\n      this.renderer.render(this.scene, this.camera)\n    },\n    pickFile() {\n      if (this.filesObject && this.fileMode) {\n        const intersects = [] // this.raycaster.intersectObject(this.filesObject)\n\n        if (intersects.length > 0) {\n          if (this.$refs.three) this.$refs.three.classList.add('pointer')\n          const instanceId = intersects[0].index\n          console.log(intersects[0])\n          if (this.PAST_INTERSECTED.instanceId !== instanceId) {\n            // new thing so clear fileData\n            this.fileData = {}\n            const obj = intersects[0].point\n            this.PAST_INTERSECTED.instanceId = instanceId\n            this.PAST_INTERSECTED.obj = obj\n            this.PAST_INTERSECTED.fileId = this.currentBucket.ids[instanceId]\n          }\n        } else if (this.PAST_INTERSECTED.instanceId) {\n          this.PAST_INTERSECTED = {}\n        }\n      }\n    },\n    positionFile(visible) {\n      if (!this.$refs.file) return\n      const elem = this.$refs.file\n      if (!visible) {\n        this.lastFileId = null\n        elem.classList.add('hidden')\n        return\n      }\n      // position hover\n      elem.classList.remove('hidden')\n      let left = (window.innerWidth * (this.mouse.x + 1)) / 2\n      if (left + HOVER_WIDTH > window.innerWidth)\n        left = left - HOVER_WIDTH - HOVER_PADDING * 4\n      let top = (window.innerHeight * (this.mouse.y - 1)) / -2 - HOVER_WIDTH / 2\n      if (top + HOVER_WIDTH > window.innerHeight) top = top - HOVER_WIDTH / 2\n      if (top < 0) top = HOVER_PADDING\n      elem.style.left = left + HOVER_PADDING + 'px'\n      elem.style.top = top + HOVER_PADDING + 'px'\n    },\n    loadFile() {\n      // get data from API\n      if (!this.$refs.file) return\n      if (!this.PAST_INTERSECTED.fileId) {\n        this.lastFileId = null\n        return\n      }\n      const fileId = this.PAST_INTERSECTED.fileId\n      if (fileId === this.lastFileId) return\n      this.fileData = {}\n      this.lastFileId = fileId\n      let url = '/files/' + fileId\n      instance.get(url).then((response) => {\n        const image = response.data.file.image.variants['300_300'].url\n        const title = response.data.file.title\n        this.fileData = { ...this.fileData, image, title }\n      })\n      url = THUMBS_BASE_URL + '/data/' + fileId\n      instance.get(url).then((colorResponse) => {\n        const paletteStr = colorResponse.data.palette_colors\n        const palette = paletteStr\n          .split(',')\n          .map((i) => i.split(':'))\n          .map((p) => {\n            return { color: p[0], percent: Number(p[1]) }\n          })\n        this.fileData = { ...this.fileData, palette }\n      })\n    },\n    pickBucket() {\n      if (this.bucketsGroup && !this.fileMode) {\n        const intersects = this.bucketsGroup.children\n          .map((ch) => this.raycaster.intersectObject(ch))\n          .filter((ch) => ch.length > 0)\n          .map((ch) => ch[0])\n\n        if (intersects.length > 0) {\n          if (this.$refs.three) this.$refs.three.classList.add('pointer')\n          const obj = intersects[0].object\n          const instanceId = obj.bucketIndex\n          if (this.PAST_INTERSECTED.instanceId !== instanceId) {\n            if (\n              this.selectedInstance.instanceId !==\n              this.PAST_INTERSECTED.instanceId\n            ) {\n              this.hideCursor()\n            }\n\n            this.PAST_INTERSECTED.instanceId = instanceId\n            this.PAST_INTERSECTED.obj = obj\n            const scale = obj.geometry.parameters.width / TILE_SIZE\n            const position = new THREE.Vector3(\n              obj.position.x,\n              obj.position.y + scale * 0.045,\n              obj.position.z - 0.001\n            )\n            this.cursor.position.copy(position)\n            this.cursor.scale = new THREE.Vector3(\n              scale * 1.02,\n              scale * 1.12,\n              scale\n            )\n            this.cursor.visible = true\n          }\n        } else if (this.PAST_INTERSECTED.instanceId) {\n          this.hideCursor()\n          this.PAST_INTERSECTED = {}\n        }\n      }\n    },\n    ...mapActions(['getcurrentAtlases'])\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/assets/variables';\n\n.three {\n  height: 100vh;\n  width: 100vw;\n  position: relative;\n}\n.pointer {\n  cursor: pointer;\n}\n.file {\n  background-color: transparentize($color: $bg-color, $amount: 0.25);\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem;\n  position: absolute;\n  min-height: calc(300px + 1rem);\n  min-width: calc(300px + 1rem);\n  max-width: calc(300px + 1rem);\n  z-index: 1;\n\n  &.hidden {\n    display: none;\n  }\n}\n.loading {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 300px;\n  height: 300px;\n}\n.palette {\n  display: flex;\n}\n.color {\n  font-size: 0.75rem;\n  height: 2rem;\n  padding: 0.5rem;\n}\n.thumbnail {\n  background-color: lighten($color: $bg-color, $amount: 10%);\n  width: 300px;\n  height: 300px;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viz.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viz.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Viz.vue?vue&type=template&id=7bdbda3f&scoped=true&\"\nimport script from \"./Viz.vue?vue&type=script&lang=js&\"\nexport * from \"./Viz.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Viz.vue?vue&type=style&index=0&id=7bdbda3f&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7bdbda3f\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div v-if=\"loaded\" class=\"grid\">\n    <div class=\"header\">\n      <h1 class=\"total\">\n        <strong>{{ formattedItemsTotal }}</strong> {{ thing }}.\n      </h1>\n    </div>\n    <div class=\"sort\">\n      <router-link\n        :class=\"['sort-button', sort === 'default' ? 'active' : '']\"\n        :to=\"{ path: '/' }\"\n      >\n        default\n      </router-link>\n      <router-link\n        :class=\"['sort-button', sort === 'hue' ? 'active' : '']\"\n        :to=\"{ path: '/', query: { sort: 'hue' } }\"\n      >\n        color\n      </router-link>\n    </div>\n    <viz class=\"viz\" />\n  </div>\n</template>\n\n<script>\nimport { mapState, mapGetters } from 'vuex'\n\nimport Viz from '@/components/Viz.vue'\n\nexport default {\n  components: { Viz },\n  data() {\n    return {}\n  },\n  watch: {\n    $route(to) {\n      const sort = to.query.sort ? to.query.sort : 'default'\n      if (sort !== this.sort) this.$store.commit('setSort', sort)\n    }\n  },\n  computed: {\n    thing() {\n      const l = Object.values(this.stuff).length\n      return this.currentBucket\n        ? this.currentBucket.name.trim()\n        : Object.values(this.stuff)\n            .filter((b) => b.count > 0)\n            .map((s, index) => (index === l - 1 ? 'and ' + s.name : s.name))\n            .join(', ')\n    },\n    total() {\n      return this.itemsTotal\n    },\n    formattedItemsTotal() {\n      return new Intl.NumberFormat().format(\n        this.currentBucket ? this.currentBucket.count : this.totalFromBuckets\n      )\n    },\n    ...mapGetters(['totalFromBuckets']),\n    ...mapState(['loaded', 'itemsTotal', 'stuff', 'currentBucket', 'sort'])\n  },\n  created() {\n    this.$store.commit('setSort', this.$route.query.sort)\n    this.$store.commit('getBuckets')\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/assets/variables';\n\n.grid {\n  background-color: $bg-color;\n  color: $main-color;\n  display: grid;\n  grid-template-columns: 12rem 1fr 12rem;\n  grid-template-rows: 1fr 2.5rem;\n}\n.header {\n  background-color: transparentize($color: $bg-color, $amount: 0.5);\n  grid-column: 1/2;\n  grid-row: 1/2;\n  z-index: 2;\n  pointer-events: none;\n}\n.total {\n  display: inline-block;\n  color: $main-color;\n  font-size: 1.25rem;\n  font-weight: normal;\n  padding: 0.5rem;\n}\n.sort {\n  background-color: transparentize($color: $bg-color, $amount: 0.5);\n  display: flex;\n  grid-column: 1/2;\n  grid-row: 2/3;\n  z-index: 1;\n\n  li {\n    margin: 0 0 0 0.5rem;\n  }\n}\n.sort-button {\n  background-color: $main-color;\n  color: $bg-color;\n  text-decoration: none;\n  display: inline-block;\n  border-radius: 0.2rem;\n  margin: 0 0 0.5rem 0.5rem;\n  padding: 0.25rem 1rem;\n\n  &.active {\n    background-color: $bg-active;\n  }\n}\n.viz {\n  grid-column: 1/4;\n  grid-row: 1/3;\n}\n</style>\n\n<style lang=\"scss\">\nbody {\n  overflow: hidden;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Viewer.vue?vue&type=template&id=27862fc4&scoped=true&\"\nimport script from \"./Viewer.vue?vue&type=script&lang=js&\"\nexport * from \"./Viewer.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Viewer.vue?vue&type=style&index=0&id=27862fc4&lang=scss&scoped=true&\"\nimport style1 from \"./Viewer.vue?vue&type=style&index=1&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"27862fc4\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=style&index=0&id=27862fc4&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=style&index=0&id=27862fc4&lang=scss&scoped=true&\""],"sourceRoot":""}